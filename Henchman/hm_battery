#include <gplv2>

# set the glyphs
zstyle ':henchman:*:glyph:' charging '%{1{⏚%}'
zstyle ':henchman:*:glyph:' discharging '%1{⌁%}'

function hm_battery() {

	local charge percent
	local charging_sigil
	local discharging_sigil
	zstyle -s ':henchman:battery:glyph:' charging charging_sigil
	zstyle -s ':henchman:battery:glyph:' discharging discharging_sigil

	hm_battery_darwin | read charge percent

	local sigil_color
	if   [[ $percent -ge 90 ]]; then
		sigil_color=default
	elif [[ $percent -ge 70 ]]; then
	    sigil_color=green
	elif [[ $percent -ge 30 ]]; then
		sigil_color=yellow
	else
		sigil_color=red
	fi

	case $charge in
		charging)    output="%F{$sigil_color}$charging_sigil%f" ;;
		charged)     output='' ;;
		discharging) output="%F{$sigil_color}$discharging_sigil"     ;;
	esac

	typeset -i scale
	scale=$(((100-percent)/10))
	color=$hm_heatmap[$scale]
	roloc=$hm_heatoff[$scale]

	echo "$output$color$percent%%$roloc"


}

case $OSTYPE in
	darwin*) source ./hm_battery_darwin ;;
esac

source ./hm_heatmap
