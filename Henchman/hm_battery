#include <gplv2>

function hm_battery() {

	local charge percent
	hm_battery_darwin | read charge percent

	local sigil_color
	if   [[ $percent -ge 90 ]]; then
		sigil_color=default
	elif [[ $percent -ge 70 ]]; then
	    sigil_color=green
	elif [[ $percent -ge 30 ]]; then
		sigil_color=yellow
	else
		sigil_color=red
	fi

	local charge_sigil
	case $charge in
		charging)    charge_sigil='%F{green}%1{⏚%}%f' ;;
		charged)     charge_sigil='' ;;
		discharging) charge_sigil="%F{$sigil_color}%1{⌁%}"     ;;
	esac

	typeset -i scale
	scale=$(((100-percent)/10))
	color=$hm_heatmap[$scale]
	roloc=$hm_heatoff[$scale]

	echo "$charge_sigil $color$percent%%$roloc"


}

case $OSTYPE in
	darwin*) source ./hm_battery_darwin ;;
esac

source ./hm_heatmap
